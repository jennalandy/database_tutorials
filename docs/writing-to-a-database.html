<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Writing to a Database | Using Databases</title>
  <meta name="description" content="5 Writing to a Database | Using Databases" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Writing to a Database | Using Databases" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="jennalandy/stat400_database_tutorials" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Writing to a Database | Using Databases" />
  
  
  

<meta name="author" content="Nick Padilla and Jenna Landy in collaboration with Hunter Glanz and Rebecca Ottesen" />


<meta name="date" content="2020-06-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="connecting-to-a-database.html"/>
<link rel="next" href="querying-a-database.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>2</b> Background</a><ul>
<li class="chapter" data-level="2.1" data-path="background.html"><a href="background.html#motivation"><i class="fa fa-check"></i><b>2.1</b> Motivation</a></li>
<li class="chapter" data-level="2.2" data-path="background.html"><a href="background.html#about-databases"><i class="fa fa-check"></i><b>2.2</b> About Databases</a><ul>
<li class="chapter" data-level="2.2.1" data-path="background.html"><a href="background.html#relational-database-model"><i class="fa fa-check"></i><b>2.2.1</b> Relational Database Model</a></li>
<li class="chapter" data-level="2.2.2" data-path="background.html"><a href="background.html#basic-introduction-to-sql"><i class="fa fa-check"></i><b>2.2.2</b> Basic Introduction to SQL</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="background.html"><a href="background.html#converting-code-to-sql"><i class="fa fa-check"></i><b>2.3</b> Converting Code to SQL</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="machine-setup.html"><a href="machine-setup.html"><i class="fa fa-check"></i><b>3</b> Machine Setup</a><ul>
<li class="chapter" data-level="3.1" data-path="machine-setup.html"><a href="machine-setup.html#linux---ubuntu"><i class="fa fa-check"></i><b>3.1</b> Linux - Ubuntu</a></li>
<li class="chapter" data-level="3.2" data-path="machine-setup.html"><a href="machine-setup.html#mac-os"><i class="fa fa-check"></i><b>3.2</b> Mac OS</a></li>
<li class="chapter" data-level="3.3" data-path="machine-setup.html"><a href="machine-setup.html#windows"><i class="fa fa-check"></i><b>3.3</b> Windows</a></li>
<li class="chapter" data-level="3.4" data-path="machine-setup.html"><a href="machine-setup.html#other-connection-options"><i class="fa fa-check"></i><b>3.4</b> Other Connection Options</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="connecting-to-a-database.html"><a href="connecting-to-a-database.html"><i class="fa fa-check"></i><b>4</b> Connecting to a Database</a><ul>
<li class="chapter" data-level="4.1" data-path="connecting-to-a-database.html"><a href="connecting-to-a-database.html#connect_julia"><i class="fa fa-check"></i><b>4.1</b> Julia</a></li>
<li class="chapter" data-level="4.2" data-path="connecting-to-a-database.html"><a href="connecting-to-a-database.html#connect_sas"><i class="fa fa-check"></i><b>4.2</b> SAS</a></li>
<li class="chapter" data-level="4.3" data-path="connecting-to-a-database.html"><a href="connecting-to-a-database.html#connect_r"><i class="fa fa-check"></i><b>4.3</b> R</a></li>
<li class="chapter" data-level="4.4" data-path="connecting-to-a-database.html"><a href="connecting-to-a-database.html#connect_python"><i class="fa fa-check"></i><b>4.4</b> Python</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html"><i class="fa fa-check"></i><b>5</b> Writing to a Database</a><ul>
<li class="chapter" data-level="5.1" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#writing_julia"><i class="fa fa-check"></i><b>5.1</b> Julia</a><ul>
<li class="chapter" data-level="5.1.1" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#alternative-method-for-big-data"><i class="fa fa-check"></i><b>5.1.1</b> Alternative method for big data</a></li>
<li class="chapter" data-level="5.1.2" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#bulk-insert"><i class="fa fa-check"></i><b>5.1.2</b> Bulk Insert</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#writing_sas"><i class="fa fa-check"></i><b>5.2</b> SAS</a></li>
<li class="chapter" data-level="5.3" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#writing_r"><i class="fa fa-check"></i><b>5.3</b> R</a><ul>
<li class="chapter" data-level="5.3.1" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#simple-table-iris"><i class="fa fa-check"></i><b>5.3.1</b> Simple Table: Iris</a></li>
<li class="chapter" data-level="5.3.2" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#related-tables-connected-by-keys-bakery-files"><i class="fa fa-check"></i><b>5.3.2</b> Related Tables Connected by Keys: Bakery Files</a></li>
<li class="chapter" data-level="5.3.3" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#alternative-method-for-big-data-1"><i class="fa fa-check"></i><b>5.3.3</b> Alternative method for big data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#writing_python"><i class="fa fa-check"></i><b>5.4</b> Python</a><ul>
<li class="chapter" data-level="5.4.1" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#simple-table-iris-1"><i class="fa fa-check"></i><b>5.4.1</b> Simple Table: Iris</a></li>
<li class="chapter" data-level="5.4.2" data-path="writing-to-a-database.html"><a href="writing-to-a-database.html#related-tables-connected-by-keys-bakery-files-1"><i class="fa fa-check"></i><b>5.4.2</b> Related Tables Connected by Keys: Bakery Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="querying-a-database.html"><a href="querying-a-database.html"><i class="fa fa-check"></i><b>6</b> Querying a Database</a><ul>
<li class="chapter" data-level="6.1" data-path="querying-a-database.html"><a href="querying-a-database.html#query_julia"><i class="fa fa-check"></i><b>6.1</b> Julia</a></li>
<li class="chapter" data-level="6.2" data-path="querying-a-database.html"><a href="querying-a-database.html#query_sas"><i class="fa fa-check"></i><b>6.2</b> SAS</a></li>
<li class="chapter" data-level="6.3" data-path="querying-a-database.html"><a href="querying-a-database.html#query_r"><i class="fa fa-check"></i><b>6.3</b> R</a></li>
<li class="chapter" data-level="6.4" data-path="querying-a-database.html"><a href="querying-a-database.html#query_python"><i class="fa fa-check"></i><b>6.4</b> Python</a><ul>
<li class="chapter" data-level="6.4.1" data-path="querying-a-database.html"><a href="querying-a-database.html#standard-python"><i class="fa fa-check"></i><b>6.4.1</b> Standard Python</a></li>
<li class="chapter" data-level="6.4.2" data-path="querying-a-database.html"><a href="querying-a-database.html#pandas"><i class="fa fa-check"></i><b>6.4.2</b> Pandas</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="web-api.html"><a href="web-api.html"><i class="fa fa-check"></i><b>7</b> Web API</a><ul>
<li class="chapter" data-level="7.1" data-path="web-api.html"><a href="web-api.html#api_julia"><i class="fa fa-check"></i><b>7.1</b> Julia</a></li>
<li class="chapter" data-level="7.2" data-path="web-api.html"><a href="web-api.html#api_r"><i class="fa fa-check"></i><b>7.2</b> R</a></li>
<li class="chapter" data-level="7.3" data-path="web-api.html"><a href="web-api.html#api_python"><i class="fa fa-check"></i><b>7.3</b> Python</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="integrating-into-a-statistics-course.html"><a href="integrating-into-a-statistics-course.html"><i class="fa fa-check"></i><b>8</b> Integrating into a Statistics Course</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using Databases</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="writing-to-a-database" class="section level1">
<h1><span class="header-section-number">5</span> Writing to a Database</h1>
<p><strong>Contents</strong></p>
<ol style="list-style-type: decimal">
<li><a href="writing-to-a-database.html#writing_julia">Writing to a Database in Julia</a></li>
<li><a href="writing-to-a-database.html#writing_sas">Writing to a Database in SAS</a></li>
<li><a href="writing-to-a-database.html#writing_r">Writing to a Database in R</a></li>
<li><a href="writing-to-a-database.html#writing_python">Writing to a Database in Python</a></li>
</ol>
<p>Once you are connected to a database, you can create tables with data! If you’re only using a database to access data, and aren’t writing to it, feel free to continue to the next chapter on <a href="querying-a-database.html#querying-a-database">querying a database</a>.</p>
<p>In the code blocks below, we assume you’ve already connected to your database and have named the connection as shown in the previous chapter on <a href="connecting-to-a-database.html#connecting-to-a-database">connecting to a database</a>.</p>
<div id="writing_julia" class="section level2">
<h2><span class="header-section-number">5.1</span> Julia</h2>
<p>Depending on your ODBC driver, you could write a table with a simple line of code: <code>ODBC.load(database, &quot;name of sql table&quot;, julia_table)</code></p>
<p>MS SQL Server along with other ODBC drivers/database systems don’t support this, so we must use an alternative method.</p>
<p><strong>Imports</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb28-1" data-line-number="1">using ODBC, CSV, JuliaDB, Query, DataFrames</a></code></pre></div>
<p>The Julia Language Community has suggested structure and instructions for working with tabular data, known as the Tables.jl interface.
Both the indexed table type from JuliaDB and the more familiar DataFrame implement these standards, and integrate well with the ODBC package.
Any of these queries can be converted into a dataframe for a more familiar interface, or into a JuliaDB IndexedTable if you need to run online algorithims or have easier
access to parallel features.</p>
<p><strong>Clear Up Workplace</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb29-1" data-line-number="1">ODBC.execute!(</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">    dsn,</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">    <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">    drop table <span class="kw">if</span> exists goods; </a>
<a class="sourceLine" id="cb29-5" data-line-number="5">    drop table <span class="kw">if</span> exists items;</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">    drop table <span class="kw">if</span> exists receipts;</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">    drop table <span class="kw">if</span> exists customers;</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">    drop table <span class="kw">if</span> exists iris;</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">    drop table <span class="kw">if</span> exists iris2;</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">    <span class="st">&quot;&quot;&quot;,</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11">)</a></code></pre></div>
<p><strong>Create tables</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb30-1" data-line-number="1">ODBC.execute!(</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">    dsn,</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">    <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4">create table customers</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">(Id int Primary Key, LastName VARCHAR(<span class="fl">30</span>), FirstName VARCHAR(<span class="fl">30</span>))</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="st">&quot;&quot;&quot;,</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb30-8" data-line-number="8"></a>
<a class="sourceLine" id="cb30-9" data-line-number="9">ODBC.execute!(</a>
<a class="sourceLine" id="cb30-10" data-line-number="10">    dsn,</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">    <span class="st">&quot;create table goods</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12">    (Id VARCHAR(<span class="fl">30</span>) Primary Key, Flavor VARCHAR(<span class="fl">30</span>), Food VARCHAR(<span class="fl">30</span>), Price FLOAT)<span class="st">&quot;,</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb30-14" data-line-number="14"></a>
<a class="sourceLine" id="cb30-15" data-line-number="15">ODBC.execute!(</a>
<a class="sourceLine" id="cb30-16" data-line-number="16">    dsn,</a>
<a class="sourceLine" id="cb30-17" data-line-number="17">    <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb30-18" data-line-number="18">create table receipts</a>
<a class="sourceLine" id="cb30-19" data-line-number="19">(ReceiptNumber int PRIMARY KEY, Date VARCHAR(<span class="fl">30</span>), CustomerId int, CONSTRAINT CustomerID FOREIGN KEY (CustomerId) references customers(Id) )</a>
<a class="sourceLine" id="cb30-20" data-line-number="20"><span class="st">&quot;&quot;&quot;,</span></a>
<a class="sourceLine" id="cb30-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb30-22" data-line-number="22"></a>
<a class="sourceLine" id="cb30-23" data-line-number="23">ODBC.execute!(</a>
<a class="sourceLine" id="cb30-24" data-line-number="24">    dsn,</a>
<a class="sourceLine" id="cb30-25" data-line-number="25">    <span class="st">&quot;create table items</span></a>
<a class="sourceLine" id="cb30-26" data-line-number="26">    (Receipt INT, Ordinal INT, Item VARCHAR(<span class="fl">30</span>),  PRIMARY KEY (Receipt,Ordinal), CONSTRAINT ReceiptNumber FOREIGN KEY (Receipt) REFERENCES receipts (ReceiptNumber) </a>
<a class="sourceLine" id="cb30-27" data-line-number="27">    , CONSTRAINT ItemId FOREIGN KEY(Item) References goods (Id) )</a>
<a class="sourceLine" id="cb30-28" data-line-number="28">    <span class="st">&quot;,</span></a>
<a class="sourceLine" id="cb30-29" data-line-number="29">)</a></code></pre></div>
<p><strong>Insert the Data</strong>
First, make a sql statement with “blank” values that we’ll put in actual values into</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb31-1" data-line-number="1">insertstmt = ODBC.prepare(dsn, <span class="st">&quot;insert into customers values(?,?,?)&quot;</span>)</a></code></pre></div>
<p>Now, for each row in the rows of our csv files, run the previous insert statement, with the values for each row
inserted into the previous “blank rows” ie those question marks</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">for</span> row <span class="kw">in</span> rows(customers)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">    ODBC.execute!(insertstmt, row)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">end</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="co">## Now do this for the remaining three tables</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">insertstmt = ODBC.prepare(dsn, <span class="st">&quot;insert into goods values(?,?,?,?)&quot;</span>)</a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="kw">for</span> row <span class="kw">in</span> rows(goods)</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">    ODBC.execute!(insertstmt, row)</a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="kw">end</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"></a>
<a class="sourceLine" id="cb32-11" data-line-number="11">insertstmt = ODBC.prepare(dsn, <span class="st">&quot;insert into receipts values(?,?,?)&quot;</span>)</a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="kw">for</span> row <span class="kw">in</span> rows(receipts)</a>
<a class="sourceLine" id="cb32-13" data-line-number="13">    ODBC.execute!(insertstmt, row)</a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="kw">end</span></a>
<a class="sourceLine" id="cb32-15" data-line-number="15"></a>
<a class="sourceLine" id="cb32-16" data-line-number="16"></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">insertstmt = ODBC.prepare(dsn, <span class="st">&quot;insert into items values(?,?,?)&quot;</span>)</a>
<a class="sourceLine" id="cb32-18" data-line-number="18"><span class="kw">for</span> row <span class="kw">in</span> rows(items)</a>
<a class="sourceLine" id="cb32-19" data-line-number="19">    ODBC.execute!(insertstmt, row)</a>
<a class="sourceLine" id="cb32-20" data-line-number="20"><span class="kw">end</span></a></code></pre></div>
<div id="alternative-method-for-big-data" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Alternative method for big data</h3>
<p>The above method requires you to have the full dataset loaded into memory. But sometimes a data file is so large that it is inefficient to load everything at once and iterate through it to insert each row into a table.</p>
<p>The method used here instead loads one row of data into memory at a time, and writes it to the SQL table before loading the next row.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb33-1" data-line-number="1">ODBC.execute!(</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">  dsn,</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">  <span class="st">&quot;&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4">    create table iris </a>
<a class="sourceLine" id="cb33-5" data-line-number="5">    (Sepal_length <span class="dt">Float</span>, Sepal_width <span class="dt">Float</span>, </a>
<a class="sourceLine" id="cb33-6" data-line-number="6">    Petal_length FLOAT, Petal_width FLOAT, Species VARCHAR(<span class="fl">20</span>))</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">  <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb33-9" data-line-number="9"></a>
<a class="sourceLine" id="cb33-10" data-line-number="10">insert_statement = ODBC.prepare(dsn,<span class="st">&quot;insert into iris values(?,?,?,?,?)&quot;</span>)</a>
<a class="sourceLine" id="cb33-11" data-line-number="11"></a>
<a class="sourceLine" id="cb33-12" data-line-number="12">open(<span class="st">&quot;iris.csv&quot;</span>) <span class="kw">do</span> f</a>
<a class="sourceLine" id="cb33-13" data-line-number="13">  readline(f) <span class="co"># skip the header row (remove this line if no header)</span></a>
<a class="sourceLine" id="cb33-14" data-line-number="14"></a>
<a class="sourceLine" id="cb33-15" data-line-number="15">  <span class="co"># read one line at a time, write to SQL table, and repeat</span></a>
<a class="sourceLine" id="cb33-16" data-line-number="16">  <span class="kw">for</span> lines <span class="kw">in</span> readlines(f)</a>
<a class="sourceLine" id="cb33-17" data-line-number="17">    rawline = map(<span class="dt">String</span>, split(lines, <span class="st">&quot;,&quot;</span>))</a>
<a class="sourceLine" id="cb33-18" data-line-number="18">    ODBC.execute!(insert_statement, rawline)</a>
<a class="sourceLine" id="cb33-19" data-line-number="19">   <span class="kw">end</span> </a>
<a class="sourceLine" id="cb33-20" data-line-number="20"><span class="kw">end</span></a></code></pre></div>
<p>The file can also be read using the CSV package. The code below would replace <code>open(&quot;iris.csv&quot;) do f</code> and everything following in the code chunk above .</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">for</span> row <span class="kw">in</span> CSV.Rows(<span class="st">&quot;iris.csv&quot;</span>, skipto=<span class="fl">2</span> )</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">    ODBC.execute!(insert_statement, row)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="kw">end</span> </a></code></pre></div>
</div>
<div id="bulk-insert" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Bulk Insert</h3>
<p>If you have bulk insert permissions you can write data without reading it into memory. For more info, see <a href="https://docs.microsoft.com/en-us/sql/relational-databases/import-export/import-bulk-data-by-using-bulk-insert-or-openrowset-bulk-sql-server?view=sql-server-ver15#bulk-insert-statement">bulk insert documentation</a>.</p>
<p>TODO: Test this. This code is not tested, since we do not have bulk load permissions.
TODO: Explain the difference between these two options.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb35-1" data-line-number="1">ODBC.execute!(</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">  dsn,</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">  <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4">    BULK INSERT iris</a>
<a class="sourceLine" id="cb35-5" data-line-number="5">    FROM <span class="ch">&#39;iris.csv&#39;</span>;</a>
<a class="sourceLine" id="cb35-6" data-line-number="6">  <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb35-8" data-line-number="8"></a>
<a class="sourceLine" id="cb35-9" data-line-number="9">ODBC.execute!(</a>
<a class="sourceLine" id="cb35-10" data-line-number="10">  dsn, </a>
<a class="sourceLine" id="cb35-11" data-line-number="11">  <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12">    INSERT INTO iris (Sepal_length, Sepal_width, Petal_length, Petal_width, Species)</a>
<a class="sourceLine" id="cb35-13" data-line-number="13">    SELECT *  </a>
<a class="sourceLine" id="cb35-14" data-line-number="14">    FROM OPENROWSET (  </a>
<a class="sourceLine" id="cb35-15" data-line-number="15">      BULK <span class="ch">&#39;iris.csv&#39;</span>) AS b;</a>
<a class="sourceLine" id="cb35-16" data-line-number="16">  <span class="st">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb35-17" data-line-number="17">)</a></code></pre></div>
</div>
</div>
<div id="writing_sas" class="section level2">
<h2><span class="header-section-number">5.2</span> SAS</h2>
<p><strong>Downloading Data</strong></p>
<p>Here we use a url libname to download the iris csv file from the internet, and preprocess it using a data step.</p>
<pre class="sas"><code>filename download url &quot;https://raw.githubusercontent.com/uiuc-cse/data-fa14/gh-pages/data/iris.csv&quot;;

data iris;
  infile download delimiter = &quot;,&quot; firstobs=2;
  input var1-var4 species $;
run;</code></pre>
<p><strong>Writing Data</strong></p>
<p>Finally, we write this data to the database.</p>
<pre class="sas"><code>proc sql;
  create table conn2.iris as (select * from work.iris);
quit;</code></pre>
</div>
<div id="writing_r" class="section level2">
<h2><span class="header-section-number">5.3</span> R</h2>
<div id="simple-table-iris" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Simple Table: Iris</h3>
<p>The first example is a basic one to illustrate how to create and fill a table.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="co"># drop table from database, if it exists</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;drop table if exists iris;&#39;</span>)</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="co"># make column names sql-compatable, can&#39;t have &quot;.&quot; in a name</span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="kw">names</span>(iris) &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">  <span class="st">&#39;SepalLength&#39;</span>,<span class="st">&#39;SepalWidth&#39;</span>,</a>
<a class="sourceLine" id="cb38-7" data-line-number="7">  <span class="st">&#39;PetalLength&#39;</span>,<span class="st">&#39;PetalWidth&#39;</span>,</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">  <span class="st">&#39;Species&#39;</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb38-10" data-line-number="10"></a>
<a class="sourceLine" id="cb38-11" data-line-number="11"><span class="co"># create new table from iris dataset</span></a>
<a class="sourceLine" id="cb38-12" data-line-number="12"><span class="kw">dbWriteTable</span>(conn, <span class="dt">name =</span> <span class="st">&quot;iris&quot;</span>,  <span class="dt">value =</span> iris)</a>
<a class="sourceLine" id="cb38-13" data-line-number="13"></a>
<a class="sourceLine" id="cb38-14" data-line-number="14"><span class="co"># make sure table exists in database</span></a>
<a class="sourceLine" id="cb38-15" data-line-number="15"><span class="kw">dbListTables</span>(conn, <span class="dt">table_name =</span> <span class="st">&quot;iris&quot;</span>)</a>
<a class="sourceLine" id="cb38-16" data-line-number="16"></a>
<a class="sourceLine" id="cb38-17" data-line-number="17"><span class="co"># list fields the new table</span></a>
<a class="sourceLine" id="cb38-18" data-line-number="18"><span class="kw">dbListFields</span>(conn, <span class="dt">name =</span> <span class="st">&quot;iris&quot;</span>)</a></code></pre></div>
</div>
<div id="related-tables-connected-by-keys-bakery-files" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Related Tables Connected by Keys: Bakery Files</h3>
<p>This example uses related tables. The table sused here represent data that may be stored by a bakery. There is a list of customers who have customer Ids, a list of goods sold with good Ids, a list of receipts with a receipt Id as well as the Id of the customer who purchased the goods, and finally a list of items on eaach receipt.</p>
<p><strong>Load the data</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co"># load dataframes</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">customers &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;BAKERY/customers.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">goods &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;BAKERY/goods.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">items &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;BAKERY/items.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">receipts &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;BAKERY/receipts.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb39-6" data-line-number="6"></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="co"># clean Item column</span></a>
<a class="sourceLine" id="cb39-8" data-line-number="8">items<span class="op">$</span>Item &lt;-<span class="st"> </span><span class="kw">trimws</span>(items<span class="op">$</span>Item)</a></code></pre></div>
<p><strong>Drop tables if they already exist</strong>
When tables are related, you can’t drop a table that’s referenced by another one. For example, the <code>receipts</code> table contains the customer Id of who made the purchase, referencing the <code>customers</code> table. This means that <code>receipts</code> must be dropped first. The relationships between tables will become more clear as we move into constructing tables.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;drop table if exists items;&#39;</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;drop table if exists goods;&#39;</span>)</a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;drop table if exists receipts;&#39;</span>)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;drop table if exists customers;&#39;</span>)</a></code></pre></div>
<p><strong>Create new tables</strong>
We can now create new tables using the <code>dbWriteTable</code> function. When we create tables, each one should have a <em>primary key</em>, and some will also have a <em>foreign key</em>.</p>
<p>The primary key is a column or multiple columns that serve as a unique identifier of each row of data. In the <code>customers</code> table, for instance, the primary key is the customer Id. This value cannot be empty. You’ll see that as we create each table, we first have to specify that the column is <code>not null</code>, and then add it as the <code>primary key</code>.</p>
<p>A foreign key is a column in a table that references the primary key of another table. For instance, in <code>receipts</code>, we have a customer Id column telling us who made each purpose. In this case, customer Id is a foreign key in the <code>receipts</code> table referencing the primary key of the <code>customers</code> table. This value cannot be empty either, so you’ll see that again we specify the column is <code>not null</code> and then add it as a <code>foreign key</code>. The first example of this is for the receipts table.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="co">## --- customers ---</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw">dbWriteTable</span>(conn, <span class="dt">name =</span> <span class="st">&quot;customers&quot;</span>, <span class="dt">value =</span> customers)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table customers alter column Id int not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table customers add primary key (Id);&#39;</span>)</a>
<a class="sourceLine" id="cb41-6" data-line-number="6"></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="co">## --- goods ---</span></a>
<a class="sourceLine" id="cb41-8" data-line-number="8"><span class="kw">dbWriteTable</span>(conn, <span class="dt">name =</span> <span class="st">&quot;goods&quot;</span>,  <span class="dt">value =</span> goods)</a>
<a class="sourceLine" id="cb41-9" data-line-number="9"></a>
<a class="sourceLine" id="cb41-10" data-line-number="10"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table goods alter column Id varchar(20) not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-11" data-line-number="11"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table goods add primary key (Id);&#39;</span>)</a>
<a class="sourceLine" id="cb41-12" data-line-number="12"></a>
<a class="sourceLine" id="cb41-13" data-line-number="13"><span class="co">## --- receipts ---</span></a>
<a class="sourceLine" id="cb41-14" data-line-number="14"><span class="kw">dbWriteTable</span>(conn, <span class="dt">name =</span> <span class="st">&quot;receipts&quot;</span>,  <span class="dt">value =</span> receipts)</a>
<a class="sourceLine" id="cb41-15" data-line-number="15"></a>
<a class="sourceLine" id="cb41-16" data-line-number="16"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table receipts alter column ReceiptNumber int not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-17" data-line-number="17"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table receipts add primary key (ReceiptNumber);&#39;</span>)</a>
<a class="sourceLine" id="cb41-18" data-line-number="18"></a>
<a class="sourceLine" id="cb41-19" data-line-number="19"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table receipts alter column CustomerID int not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-20" data-line-number="20"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table receipts add foreign key (CustomerID) references customers (Id);&#39;</span>)</a>
<a class="sourceLine" id="cb41-21" data-line-number="21"></a>
<a class="sourceLine" id="cb41-22" data-line-number="22"><span class="co">## --- items ---</span></a>
<a class="sourceLine" id="cb41-23" data-line-number="23"><span class="kw">dbWriteTable</span>(conn, <span class="dt">name =</span> <span class="st">&quot;items&quot;</span>,  <span class="dt">value =</span> items)</a>
<a class="sourceLine" id="cb41-24" data-line-number="24"></a>
<a class="sourceLine" id="cb41-25" data-line-number="25"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table items alter column Receipt int not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-26" data-line-number="26"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table items alter column Ordinal int not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-27" data-line-number="27"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table items add primary key (Receipt, Ordinal);&#39;</span>)</a>
<a class="sourceLine" id="cb41-28" data-line-number="28"></a>
<a class="sourceLine" id="cb41-29" data-line-number="29"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table items add foreign key (Receipt) references receipts (ReceiptNumber);&#39;</span>)</a>
<a class="sourceLine" id="cb41-30" data-line-number="30"></a>
<a class="sourceLine" id="cb41-31" data-line-number="31"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table items alter column Item varchar(20) not null;&#39;</span>)</a>
<a class="sourceLine" id="cb41-32" data-line-number="32"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;alter table items add foreign key (Item) references goods (Id);&#39;</span>)</a></code></pre></div>
<p><strong>Check key usage</strong>
The following query will display information on the key usage within a table. We can use this to check that the keys were applied the way we were expecting. For the <code>items</code> table, receipt and ordianl together should serve as the primary key, receipt should be a foreign key referencing the <code>receipts</code> table, and item should be a foreign key referencing the <code>goods</code> table.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># check key usage in this table</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw">dbGetQuery</span>(conn, <span class="st">&quot;select * from information_schema.key_column_usage where TABLE_NAME = &#39;items&#39;;&quot;</span>)[<span class="kw">c</span>(<span class="st">&#39;CONSTRAINT_NAME&#39;</span>, <span class="st">&#39;COLUMN_NAME&#39;</span>)]</a></code></pre></div>
<pre><code>               CONSTRAINT_NAME COLUMN_NAME
1    FK__items__Item__5006DFF2        Item
2 FK__items__Receipt__4F12BBB9     Receipt
3  PK__items__286FD81DF2E2854C     Ordinal
4  PK__items__286FD81DF2E2854C     Receipt</code></pre>
</div>
<div id="alternative-method-for-big-data-1" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Alternative method for big data</h3>
<p>The above method requires you to have the full dataset loaded into memory. But sometimes a data file is so large that it is inefficient to load everything at once and iterate through it to insert each row into a table.</p>
<p>The method used here instead loads one row of data into memory at a time, and writes it to the SQL table before loading the next row.</p>
<p>It’s a bit more complex because we can’t use the simple <code>dbWriteTable</code> anymore. Instead, we define the table with a <code>create table</code> statement with <code>dbExecute</code>. To keep the code readable, we suggest using the <code>paste</code> function and using the same indentation you would in a sql file.</p>
<p>For simplicity and lack of repetition, this example doesn’t use the four related datasets again. For information on defining primary and foreign keys in a <code>create table</code> statement, see the <a href="https://www.w3schools.com/sql/sql_primarykey.ASP">w3schools example for SQL primary key on SQL Server</a> and for <a href="https://www.w3schools.com/sql/sql_foreignkey.asp">foreign keys</a>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">dbExecute</span>(conn, <span class="st">&#39;drop table if exists iris;&#39;</span>)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2"></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="kw">dbExecute</span>(conn, <span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">  <span class="st">&quot;create table iris(&quot;</span>,</a>
<a class="sourceLine" id="cb44-5" data-line-number="5">    <span class="st">&quot;SepalLength decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb44-6" data-line-number="6">    <span class="st">&quot;SepalWidth decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb44-7" data-line-number="7">    <span class="st">&quot;PetalLength decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb44-8" data-line-number="8">    <span class="st">&quot;PetalWidth decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb44-9" data-line-number="9">    <span class="st">&quot;Species varchar(50)&quot;</span>,</a>
<a class="sourceLine" id="cb44-10" data-line-number="10">  <span class="st">&quot;);&quot;</span></a>
<a class="sourceLine" id="cb44-11" data-line-number="11">))</a>
<a class="sourceLine" id="cb44-12" data-line-number="12"></a>
<a class="sourceLine" id="cb44-13" data-line-number="13">f &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;iris.csv&quot;</span>, <span class="dt">open =</span> <span class="st">&quot;r&quot;</span>)</a>
<a class="sourceLine" id="cb44-14" data-line-number="14">first =<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb44-15" data-line-number="15"></a>
<a class="sourceLine" id="cb44-16" data-line-number="16"><span class="co"># while the next line exists</span></a>
<a class="sourceLine" id="cb44-17" data-line-number="17"><span class="cf">while</span> (<span class="kw">length</span>(oneLine &lt;-<span class="st"> </span><span class="kw">readLines</span>(f, <span class="dt">n =</span> <span class="dv">1</span>)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb44-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb44-19" data-line-number="19">  <span class="co"># this skips the header row. delete this if there&#39;s no header</span></a>
<a class="sourceLine" id="cb44-20" data-line-number="20">  <span class="cf">if</span> (first) {</a>
<a class="sourceLine" id="cb44-21" data-line-number="21">    first =<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb44-22" data-line-number="22">    <span class="cf">next</span></a>
<a class="sourceLine" id="cb44-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb44-24" data-line-number="24">  </a>
<a class="sourceLine" id="cb44-25" data-line-number="25">  <span class="co"># separate values</span></a>
<a class="sourceLine" id="cb44-26" data-line-number="26">  myLine &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(oneLine, <span class="st">&quot;,&quot;</span>))</a>
<a class="sourceLine" id="cb44-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb44-28" data-line-number="28">  <span class="co"># insert values</span></a>
<a class="sourceLine" id="cb44-29" data-line-number="29">  insert_statement &lt;-<span class="st"> </span><span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb44-30" data-line-number="30">    <span class="st">&quot;insert into iris(&quot;</span>,</a>
<a class="sourceLine" id="cb44-31" data-line-number="31">      <span class="st">&quot;SepalLength,&quot;</span>,</a>
<a class="sourceLine" id="cb44-32" data-line-number="32">      <span class="st">&quot;SepalWidth,&quot;</span>,</a>
<a class="sourceLine" id="cb44-33" data-line-number="33">      <span class="st">&quot;PetalLength,&quot;</span>,</a>
<a class="sourceLine" id="cb44-34" data-line-number="34">      <span class="st">&quot;PetalWidth,&quot;</span>,</a>
<a class="sourceLine" id="cb44-35" data-line-number="35">      <span class="st">&quot;Species&quot;</span>,</a>
<a class="sourceLine" id="cb44-36" data-line-number="36">    <span class="st">&quot;) values (&quot;</span>,</a>
<a class="sourceLine" id="cb44-37" data-line-number="37">      <span class="kw">as.numeric</span>(myLine[<span class="dv">1</span>]), <span class="st">&quot;,&quot;</span>,</a>
<a class="sourceLine" id="cb44-38" data-line-number="38">      <span class="kw">as.numeric</span>(myLine[<span class="dv">2</span>]), <span class="st">&quot;,&quot;</span>,</a>
<a class="sourceLine" id="cb44-39" data-line-number="39">      <span class="kw">as.numeric</span>(myLine[<span class="dv">3</span>]), <span class="st">&quot;,&quot;</span>,</a>
<a class="sourceLine" id="cb44-40" data-line-number="40">      <span class="kw">as.numeric</span>(myLine[<span class="dv">4</span>]),<span class="st">&quot;,&#39;&quot;</span>,</a>
<a class="sourceLine" id="cb44-41" data-line-number="41">      <span class="kw">str_replace_all</span>(myLine[<span class="dv">5</span>], <span class="st">&#39;</span><span class="ch">\&quot;</span><span class="st">&#39;</span>,<span class="st">&#39;&#39;</span>), <span class="st">&quot;&#39;);&quot;</span></a>
<a class="sourceLine" id="cb44-42" data-line-number="42">  )</a>
<a class="sourceLine" id="cb44-43" data-line-number="43">  <span class="kw">dbExecute</span>(conn, insert_statement)</a>
<a class="sourceLine" id="cb44-44" data-line-number="44">}</a>
<a class="sourceLine" id="cb44-45" data-line-number="45"><span class="kw">close</span>(f)</a></code></pre></div>
</div>
</div>
<div id="writing_python" class="section level2">
<h2><span class="header-section-number">5.4</span> Python</h2>
<p>In python, there’s no pretty function to create a table from a file or pandas DataFrame like there is in R. Here, we rely exclusively on the cursor’s <code>execute</code> method and raw sql strings. To keep the code readable, we suggest using the <code>.join</code> method on an empty string or space (<code>&quot; &quot;</code>) and using the same indentation you would in a sql file.</p>
<p>Note that if you are using pandas, you can write data in the same way as shown here by iterating through the rows of the DataFrame as opposed to lines of a file.</p>
<div id="simple-table-iris-1" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Simple Table: Iris</h3>
<p>The first example is a basic one to illustrate how to create and fill a table.</p>
<p><strong>Load data</strong></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="co"># load in data</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;iris.csv&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb45-3" data-line-number="3">    iris_lines <span class="op">=</span> <span class="bu">file</span>.readlines()[<span class="dv">1</span>:]</a></code></pre></div>
<p><strong>Drop table if it exists, and create a new table</strong></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co"># drop table if it already exists</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">cursor.execute(<span class="st">&quot;drop table if exists iris;&quot;</span>)</a>
<a class="sourceLine" id="cb46-3" data-line-number="3"></a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="co"># create new table</span></a>
<a class="sourceLine" id="cb46-5" data-line-number="5">cursor.execute(<span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb46-6" data-line-number="6">    <span class="st">&quot;create table iris(&quot;</span>,</a>
<a class="sourceLine" id="cb46-7" data-line-number="7">        <span class="st">&quot;SepalLength decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb46-8" data-line-number="8">        <span class="st">&quot;SepalWidth decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb46-9" data-line-number="9">        <span class="st">&quot;PetalLength decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb46-10" data-line-number="10">        <span class="st">&quot;PetalWidth decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb46-11" data-line-number="11">        <span class="st">&quot;Species varchar(50)&quot;</span></a>
<a class="sourceLine" id="cb46-12" data-line-number="12">    <span class="st">&quot;);&quot;</span></a>
<a class="sourceLine" id="cb46-13" data-line-number="13">]))</a></code></pre></div>
<p><strong>Insert values</strong>
To insert values into a sql table, we have two options.</p>
<p>This first strategy is beneficial because it doesn’t require you to load the full file into memory. This means that even if a dataset is very large, python can handle it. Here we only show using it to enter the first line of data, but this could be put inside of a for loop to iterate over all rows.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="co"># single input: write one item to table</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2">line <span class="op">=</span> iris_lines[<span class="dv">0</span>].split(<span class="st">&#39;,&#39;</span>)</a>
<a class="sourceLine" id="cb47-3" data-line-number="3">cursor.execute(</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">    <span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb47-5" data-line-number="5">        <span class="st">&quot;insert into iris(&quot;</span>,</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">            <span class="st">&quot;SepalLength,&quot;</span>,</a>
<a class="sourceLine" id="cb47-7" data-line-number="7">            <span class="st">&quot;SepalWidth,&quot;</span>,</a>
<a class="sourceLine" id="cb47-8" data-line-number="8">            <span class="st">&quot;PetalLength,&quot;</span>,</a>
<a class="sourceLine" id="cb47-9" data-line-number="9">            <span class="st">&quot;PetalWidth,&quot;</span>,</a>
<a class="sourceLine" id="cb47-10" data-line-number="10">            <span class="st">&quot;Species&quot;</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11">        <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb47-12" data-line-number="12">        <span class="st">&quot;values(?, ?, ?, ?, ?)&quot;</span>]),</a>
<a class="sourceLine" id="cb47-13" data-line-number="13">    line[<span class="dv">0</span>],</a>
<a class="sourceLine" id="cb47-14" data-line-number="14">    line[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb47-15" data-line-number="15">    line[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb47-16" data-line-number="16">    line[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb47-17" data-line-number="17">    line[<span class="dv">4</span>].strip()</a>
<a class="sourceLine" id="cb47-18" data-line-number="18">)</a></code></pre></div>
<p>This second option is used to insert many rows of data into the table in one command. Using <code>cursor.executemany</code>, we can pass the same insert statement as above, but then a list of a list of values, where each inner list is 1 row of data. This is nice because it is less code. However, we prefer the first option because it is more consistent in that it will work for data tables of any size.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="co"># bulk input: write many items to table</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2">cursor.executemany(</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">    <span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb48-4" data-line-number="4">            <span class="st">&quot;insert into iris(&quot;</span>,</a>
<a class="sourceLine" id="cb48-5" data-line-number="5">                <span class="st">&quot;SepalLength,&quot;</span>,</a>
<a class="sourceLine" id="cb48-6" data-line-number="6">                <span class="st">&quot;SepalWidth,&quot;</span>,</a>
<a class="sourceLine" id="cb48-7" data-line-number="7">                <span class="st">&quot;PetalLength,&quot;</span>,</a>
<a class="sourceLine" id="cb48-8" data-line-number="8">                <span class="st">&quot;PetalWidth,&quot;</span>,</a>
<a class="sourceLine" id="cb48-9" data-line-number="9">                <span class="st">&quot;Species&quot;</span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10">            <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb48-11" data-line-number="11">            <span class="st">&quot;values(?, ?, ?, ?, ?)&quot;</span>]),</a>
<a class="sourceLine" id="cb48-12" data-line-number="12">    [line.split(<span class="st">&#39;,&#39;</span>) <span class="cf">for</span> line <span class="kw">in</span> iris_lines[<span class="dv">1</span>:]] <span class="co"># [1:] because observation 0 was inserted above</span></a>
<a class="sourceLine" id="cb48-13" data-line-number="13">)</a></code></pre></div>
</div>
<div id="related-tables-connected-by-keys-bakery-files-1" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Related Tables Connected by Keys: Bakery Files</h3>
<p>This example uses related tables. The tables used here represent data that may be stored by a bakery. There is a list of customers who have customer Ids, a list of goods sold with good Ids, a list of receipts with a receipt Id as well as the Id of the customer who purchased the goods, and finally a list of items on eaach receipt.</p>
<p><strong>Drop tables if they already exist</strong>
When tables are related, you can’t drop a table that’s referenced by another one. For example, the <code>receipts</code> table contains the customer Id of who made the purchase, referencing the <code>customers</code> table. This means that <code>receipts</code> must be dropped first. The relationships between tables will become more clear as we move into constructing tables.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb49-1" data-line-number="1">cursor.execute(<span class="st">&quot;drop table if exists items;&quot;</span>)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">cursor.execute(<span class="st">&quot;drop table if exists goods;&quot;</span>) <span class="co"># referenced by items</span></a>
<a class="sourceLine" id="cb49-3" data-line-number="3">cursor.execute(<span class="st">&quot;drop table if exists receipts;&quot;</span>) <span class="co"># referenced by items</span></a>
<a class="sourceLine" id="cb49-4" data-line-number="4">cursor.execute(<span class="st">&quot;drop table if exists customers;&quot;</span>) <span class="co"># referenced by receipts</span></a></code></pre></div>
<p><strong>Create new tables</strong>
We can now create new tables using <code>create table</code> statements and <code>cursor.execute</code>. When we create tables, each one should have a <em>primary key</em>, and some will also have a <em>foreign key</em>.</p>
<p>The primary key is a column or multiple columns that serve as a unique identifier of each row of data. In the <code>customers</code> table, for instance, the primary key is the customer Id. This value cannot be empty. This constraint is added automatically when we set the column(s) as the primary key.</p>
<p>A foreign key is a column in a table that references the primary key of another table. For instance, in <code>receipts</code>, we have a customer Id column telling us who made each purpose. In this case, customer Id is a foreign key in the <code>receipts</code> table referencing the primary key of the <code>customers</code> table. This value cannot be empty either, and the constraint will automtically be applied when you set it as a foreign key.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="co"># create new tables</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2">cursor.execute(<span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">    <span class="st">&quot;create table customers(&quot;</span>,</a>
<a class="sourceLine" id="cb50-4" data-line-number="4">        <span class="st">&quot;Id int,&quot;</span>,</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">        <span class="st">&quot;LastName varchar(50),&quot;</span>,</a>
<a class="sourceLine" id="cb50-6" data-line-number="6">        <span class="st">&quot;FirstName varchar(50),&quot;</span>,</a>
<a class="sourceLine" id="cb50-7" data-line-number="7">        <span class="st">&quot;constraint customers_pk primary key (Id)&quot;</span></a>
<a class="sourceLine" id="cb50-8" data-line-number="8">    <span class="st">&quot;);&quot;</span></a>
<a class="sourceLine" id="cb50-9" data-line-number="9">]))</a>
<a class="sourceLine" id="cb50-10" data-line-number="10"></a>
<a class="sourceLine" id="cb50-11" data-line-number="11">cursor.execute(<span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb50-12" data-line-number="12">    <span class="st">&quot;create table receipts(&quot;</span>,</a>
<a class="sourceLine" id="cb50-13" data-line-number="13">        <span class="st">&quot;ReceiptNumber int,&quot;</span>,</a>
<a class="sourceLine" id="cb50-14" data-line-number="14">        <span class="st">&quot;Date date,&quot;</span>,</a>
<a class="sourceLine" id="cb50-15" data-line-number="15">        <span class="st">&quot;CustomerId int,&quot;</span>,</a>
<a class="sourceLine" id="cb50-16" data-line-number="16">        <span class="st">&quot;constraint receipts_pk primary key (ReceiptNumber),&quot;</span>,</a>
<a class="sourceLine" id="cb50-17" data-line-number="17">        <span class="st">&quot;constraint receipts_customers_fk foreign key (CustomerId) references customers (Id)&quot;</span></a>
<a class="sourceLine" id="cb50-18" data-line-number="18">    <span class="st">&quot;);&quot;</span></a>
<a class="sourceLine" id="cb50-19" data-line-number="19">]))</a>
<a class="sourceLine" id="cb50-20" data-line-number="20"></a>
<a class="sourceLine" id="cb50-21" data-line-number="21">cursor.execute(<span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb50-22" data-line-number="22">    <span class="st">&quot;create table goods(&quot;</span>,</a>
<a class="sourceLine" id="cb50-23" data-line-number="23">        <span class="st">&quot;Id varchar(50),&quot;</span>,</a>
<a class="sourceLine" id="cb50-24" data-line-number="24">        <span class="st">&quot;Flavor varchar(50),&quot;</span>,</a>
<a class="sourceLine" id="cb50-25" data-line-number="25">        <span class="st">&quot;Food varchar(50),&quot;</span>,</a>
<a class="sourceLine" id="cb50-26" data-line-number="26">        <span class="st">&quot;Price decimal(5,2),&quot;</span>,</a>
<a class="sourceLine" id="cb50-27" data-line-number="27">        <span class="st">&quot;constraint goods_pk primary key (Id)&quot;</span></a>
<a class="sourceLine" id="cb50-28" data-line-number="28">    <span class="st">&quot;);&quot;</span></a>
<a class="sourceLine" id="cb50-29" data-line-number="29">]))</a>
<a class="sourceLine" id="cb50-30" data-line-number="30"></a>
<a class="sourceLine" id="cb50-31" data-line-number="31">cursor.execute(<span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb50-32" data-line-number="32">    <span class="st">&quot;create table items(&quot;</span>,</a>
<a class="sourceLine" id="cb50-33" data-line-number="33">        <span class="st">&quot;Receipt int,&quot;</span>,</a>
<a class="sourceLine" id="cb50-34" data-line-number="34">        <span class="st">&quot;Ordinal int,&quot;</span>,</a>
<a class="sourceLine" id="cb50-35" data-line-number="35">        <span class="st">&quot;Item varchar(50),&quot;</span>,</a>
<a class="sourceLine" id="cb50-36" data-line-number="36">        <span class="st">&quot;constraint items_pk primary key (Receipt, Ordinal),&quot;</span>,</a>
<a class="sourceLine" id="cb50-37" data-line-number="37">        <span class="st">&quot;constraint items_goods_fk foreign key (Item) references goods (Id),&quot;</span>,</a>
<a class="sourceLine" id="cb50-38" data-line-number="38">        <span class="st">&quot;constraint items_receipts_fk foreign key (Receipt) references receipts (ReceiptNumber)&quot;</span></a>
<a class="sourceLine" id="cb50-39" data-line-number="39">    <span class="st">&quot;);&quot;</span></a>
<a class="sourceLine" id="cb50-40" data-line-number="40">]))</a></code></pre></div>
<p><strong>Load in data</strong>
For each table, open file and insert values one line at a time. See the simple table example above for more details.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;BAKERY/customers.csv&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-2" data-line-number="2">    header <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb51-3" data-line-number="3">    <span class="cf">for</span> line <span class="kw">in</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-4" data-line-number="4">        line <span class="op">=</span> line.split(<span class="st">&#39;, &#39;</span>)</a>
<a class="sourceLine" id="cb51-5" data-line-number="5">        <span class="cf">if</span> header: <span class="co"># dont write header row to database!</span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6">            header <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb51-7" data-line-number="7">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb51-8" data-line-number="8">            cursor.execute(</a>
<a class="sourceLine" id="cb51-9" data-line-number="9">                <span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb51-10" data-line-number="10">                    <span class="st">&quot;insert into customers(&quot;</span>,</a>
<a class="sourceLine" id="cb51-11" data-line-number="11">                        <span class="st">&quot;Id,&quot;</span>,</a>
<a class="sourceLine" id="cb51-12" data-line-number="12">                        <span class="st">&quot;FirstName,&quot;</span>,</a>
<a class="sourceLine" id="cb51-13" data-line-number="13">                        <span class="st">&quot;LastName&quot;</span>,</a>
<a class="sourceLine" id="cb51-14" data-line-number="14">                    <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb51-15" data-line-number="15">                    <span class="st">&quot;values(?, ?, ?)&quot;</span>]),</a>
<a class="sourceLine" id="cb51-16" data-line-number="16">                line[<span class="dv">0</span>],</a>
<a class="sourceLine" id="cb51-17" data-line-number="17">                line[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb51-18" data-line-number="18">                line[<span class="dv">2</span>].strip()</a>
<a class="sourceLine" id="cb51-19" data-line-number="19">            )</a>
<a class="sourceLine" id="cb51-20" data-line-number="20"></a>
<a class="sourceLine" id="cb51-21" data-line-number="21"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;BAKERY/receipts.csv&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-22" data-line-number="22">    header <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb51-23" data-line-number="23">    <span class="cf">for</span> line <span class="kw">in</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-24" data-line-number="24">        line <span class="op">=</span> line.split(<span class="st">&#39;, &#39;</span>)</a>
<a class="sourceLine" id="cb51-25" data-line-number="25">        <span class="cf">if</span> header:</a>
<a class="sourceLine" id="cb51-26" data-line-number="26">            header <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb51-27" data-line-number="27">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb51-28" data-line-number="28">            <span class="co"># reformatting year: YYYYMMDD from DD-Mon-YYYY</span></a>
<a class="sourceLine" id="cb51-29" data-line-number="29">            <span class="co"># sql likes the YYYYMMDD format</span></a>
<a class="sourceLine" id="cb51-30" data-line-number="30">            date <span class="op">=</span> line[<span class="dv">1</span>].strip().replace(<span class="st">&quot;&#39;&quot;</span>,<span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb51-31" data-line-number="31">            year <span class="op">=</span> date.split(<span class="st">&#39;-&#39;</span>)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb51-32" data-line-number="32">            day <span class="op">=</span> date.split(<span class="st">&#39;-&#39;</span>)[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb51-33" data-line-number="33">            <span class="cf">if</span> <span class="bu">len</span>(day) <span class="op">==</span> <span class="dv">1</span>:</a>
<a class="sourceLine" id="cb51-34" data-line-number="34">                day <span class="op">=</span> <span class="st">&#39;0&#39;</span><span class="op">+</span>day</a>
<a class="sourceLine" id="cb51-35" data-line-number="35">            month <span class="op">=</span> <span class="bu">str</span>(month_abbr_dict[date.split(<span class="st">&#39;-&#39;</span>)[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb51-36" data-line-number="36">            date2 <span class="op">=</span> year<span class="op">+</span>month<span class="op">+</span>day</a>
<a class="sourceLine" id="cb51-37" data-line-number="37">            cursor.execute(</a>
<a class="sourceLine" id="cb51-38" data-line-number="38">                <span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb51-39" data-line-number="39">                    <span class="st">&quot;insert into receipts(&quot;</span>,</a>
<a class="sourceLine" id="cb51-40" data-line-number="40">                        <span class="st">&quot;ReceiptNumber,&quot;</span>,</a>
<a class="sourceLine" id="cb51-41" data-line-number="41">                        <span class="st">&quot;Date,&quot;</span>,</a>
<a class="sourceLine" id="cb51-42" data-line-number="42">                        <span class="st">&quot;CustomerId&quot;</span>,</a>
<a class="sourceLine" id="cb51-43" data-line-number="43">                    <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb51-44" data-line-number="44">                    <span class="st">&quot;values(?, ?, ?)&quot;</span>]),</a>
<a class="sourceLine" id="cb51-45" data-line-number="45">                line[<span class="dv">0</span>],</a>
<a class="sourceLine" id="cb51-46" data-line-number="46">                date2,</a>
<a class="sourceLine" id="cb51-47" data-line-number="47">                line[<span class="dv">2</span>].strip()</a>
<a class="sourceLine" id="cb51-48" data-line-number="48">            )</a>
<a class="sourceLine" id="cb51-49" data-line-number="49"></a>
<a class="sourceLine" id="cb51-50" data-line-number="50"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;BAKERY/goods.csv&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-51" data-line-number="51">    header <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb51-52" data-line-number="52">    <span class="cf">for</span> line <span class="kw">in</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-53" data-line-number="53">        line <span class="op">=</span> line.strip().split(<span class="st">&#39;,&#39;</span>)</a>
<a class="sourceLine" id="cb51-54" data-line-number="54">        <span class="cf">if</span> header:</a>
<a class="sourceLine" id="cb51-55" data-line-number="55">            header <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb51-56" data-line-number="56">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb51-57" data-line-number="57">            cursor.execute(</a>
<a class="sourceLine" id="cb51-58" data-line-number="58">                <span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb51-59" data-line-number="59">                    <span class="st">&quot;insert into goods(&quot;</span>,</a>
<a class="sourceLine" id="cb51-60" data-line-number="60">                        <span class="st">&quot;Id,&quot;</span>,</a>
<a class="sourceLine" id="cb51-61" data-line-number="61">                        <span class="st">&quot;Flavor,&quot;</span>,</a>
<a class="sourceLine" id="cb51-62" data-line-number="62">                        <span class="st">&quot;Food,&quot;</span>,</a>
<a class="sourceLine" id="cb51-63" data-line-number="63">                        <span class="st">&quot;Price&quot;</span></a>
<a class="sourceLine" id="cb51-64" data-line-number="64">                    <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb51-65" data-line-number="65">                    <span class="st">&quot;values(?, ?, ?, ?)&quot;</span>]),</a>
<a class="sourceLine" id="cb51-66" data-line-number="66">                line[<span class="dv">0</span>],</a>
<a class="sourceLine" id="cb51-67" data-line-number="67">                line[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb51-68" data-line-number="68">                line[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb51-69" data-line-number="69">                <span class="bu">float</span>(line[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb51-70" data-line-number="70">            )</a>
<a class="sourceLine" id="cb51-71" data-line-number="71"></a>
<a class="sourceLine" id="cb51-72" data-line-number="72"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;BAKERY/items.csv&#39;</span>) <span class="im">as</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-73" data-line-number="73">    header <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb51-74" data-line-number="74">    <span class="cf">for</span> line <span class="kw">in</span> <span class="bu">file</span>:</a>
<a class="sourceLine" id="cb51-75" data-line-number="75">        line <span class="op">=</span> line.split(<span class="st">&#39;, &#39;</span>)</a>
<a class="sourceLine" id="cb51-76" data-line-number="76">        <span class="cf">if</span> header:</a>
<a class="sourceLine" id="cb51-77" data-line-number="77">            header <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb51-78" data-line-number="78">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb51-79" data-line-number="79">            cursor.execute(</a>
<a class="sourceLine" id="cb51-80" data-line-number="80">                <span class="st">&quot; &quot;</span>.join([</a>
<a class="sourceLine" id="cb51-81" data-line-number="81">                    <span class="st">&quot;insert into items(&quot;</span>,</a>
<a class="sourceLine" id="cb51-82" data-line-number="82">                        <span class="st">&quot;Receipt,&quot;</span>,</a>
<a class="sourceLine" id="cb51-83" data-line-number="83">                        <span class="st">&quot;Ordinal,&quot;</span>,</a>
<a class="sourceLine" id="cb51-84" data-line-number="84">                        <span class="st">&quot;Item&quot;</span>,</a>
<a class="sourceLine" id="cb51-85" data-line-number="85">                    <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb51-86" data-line-number="86">                    <span class="st">&quot;values(?, ?, ?)&quot;</span>]),</a>
<a class="sourceLine" id="cb51-87" data-line-number="87">                <span class="bu">int</span>(line[<span class="dv">0</span>]),</a>
<a class="sourceLine" id="cb51-88" data-line-number="88">                <span class="bu">int</span>(line[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb51-89" data-line-number="89">                line[<span class="dv">2</span>].strip()</a>
<a class="sourceLine" id="cb51-90" data-line-number="90">            )</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="connecting-to-a-database.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="querying-a-database.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
